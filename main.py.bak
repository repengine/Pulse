"""
main.py

Pulse v3.5 execution shell. Initializes simulation state, runs a short simulation loop,
generates foresight forecasts, and prints Strategos Digest summaries.

Author: Pulse v3.5
"""
print("🧠 Starting Pulse v3.5...")

from worldstate import WorldState
from turn_engine import run_turn
from causal_rules import apply_causal_rules
from forecast_output.forecast_generator import generate_forecast
from forecast_output.pfpa_logger import log_forecast_to_pfpa
from memory.forecast_memory import ForecastMemory
from operator_interface.strategos_digest import generate_strategos_digest


def run_pulse_simulation(turns: int = 5):
    """
    Initializes Pulse and runs a simulation loop with forecast generation.
    """
    print("\n🌐 Initializing Pulse v3.5...\n")
    state = WorldState()
    memory = ForecastMemory()

    for _ in range(turns):
        print(f"\n🔄 Running Turn {state.turn + 1}...")
        run_turn(state, rule_fn=apply_causal_rules)
        forecast = generate_forecast(state, horizon_days=2)
        memory.store(forecast)
        log_forecast_to_pfpa(forecast)

    print("\n📘 Generating Strategos Digest...\n")
    digest = generate_strategos_digest(memory, n=min(turns, 5))
    print(digest)


if __name__ == "__main__":
    run_pulse_simulation(turns=5)
