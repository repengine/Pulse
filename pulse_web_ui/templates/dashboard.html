{% extends "base.html" %}

{% block title %}Dashboard - Pulse UI{% endblock %}

{% block header %}System Dashboard{% endblock %}

{% block content %}
<div class="dashboard-grid">
    <div class="dashboard-card status-card">
        <h3>System Status</h3>
        <p class="status-{{ system_status.lower() }}">{{ system_status }}</p>
    </div>

    <div class="dashboard-card processes-card">
        <h3>Active Processes</h3>
        {% if active_processes %}
            <ul>
                {% for process in active_processes %}
                    <li>{{ process }}</li>
                {% endfor %}
            </ul>
        {% else %}
            <p>None</p>
        {% endif %}
    </div>

    <div class="dashboard-card learning-card">
        <h3>Recursive Learning</h3>
        <p class="status-{{ 'enabled' if recursive_learning_status == 'Enabled' else 'disabled' }}">{{ recursive_learning_status }}</p>
        <!-- Link to settings page to toggle this -->
        <a href="{{ url_for('settings') }}">Change</a>
    </div>

    <div class="dashboard-card activity-card">
        <h3>Recent Activity</h3>
        {% if recent_activity %}
            <ul>
                {% for activity in recent_activity %}
                    <li><strong>{{ activity.ts }}:</strong> {{ activity.msg }}</li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No recent activity.</p>
        {% endif %}
    </div>

    <div class="dashboard-card resource-card">
        <h3>Resource Usage</h3>
        <p>CPU: <span id="cpu-usage">Loading...</span>%</p>
        <p>Memory: <span id="memory-usage">Loading...</span> MB</p>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetch('/api/system_status')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                const cpuUsageEl = document.getElementById('cpu-usage');
                const memoryUsageEl = document.getElementById('memory-usage');

                if (cpuUsageEl) {
                    cpuUsageEl.textContent = data.cpu_usage !== undefined ? data.cpu_usage : 'N/A';
                }
                if (memoryUsageEl) {
                    memoryUsageEl.textContent = data.memory_usage !== undefined ? data.memory_usage : 'N/A';
                }
            })
            .catch(error => {
                console.error('Error fetching system status:', error);
                const cpuUsageEl = document.getElementById('cpu-usage');
                const memoryUsageEl = document.getElementById('memory-usage');
                if (cpuUsageEl) cpuUsageEl.textContent = 'Error';
                if (memoryUsageEl) memoryUsageEl.textContent = 'Error';
            });
    });
</script>
{% endblock %}