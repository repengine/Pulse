{% extends "base.html" %}

{% block title %}Memory Explorer - Pulse UI{% endblock %}

{% block header %}Memory Explorer{% endblock %}

{% block content %}
<div class="memory-explorer-layout">

    {# --- Browsing Pane --- #}
    <div class="memory-list-pane">
        <h3>Browse Memory Items</h3>
        {# Add search/filter controls here later #}
        <div class="item-categories">
            {% if items_by_category %}
                {% for category, items in items_by_category.items() %}
                    <h4>{{ category.capitalize() }}</h4>
                    {% if items %}
                        <ul>
                            {% for item in items %}
                                <li>
                                    <a href="#" onclick="loadItemDetails('{{ item.id }}'); return false;">
                                        {{ item.name }} ({{ item.id }})
                                    </a>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p><i>No items in this category.</i></p>
                    {% endif %}
                {% endfor %}
            {% else %}
                <p><i>Memory is empty or could not be loaded.</i></p>
            {% endif %}
        </div>
    </div>

    {# --- Detail View Pane --- #}
    <div class="memory-detail-pane">
        <h3>Item Details</h3>
        <div id="item-details-content">
            <p><i>Select an item from the list to view details.</i></p>
        </div>
    </div>

</div>

<style>
    .memory-explorer-layout {
        display: flex;
        gap: 20px;
        height: calc(100vh - 150px); /* Adjust based on header/footer height */
    }
    .memory-list-pane {
        flex: 1; /* Takes up 1 part */
        overflow-y: auto;
        padding: 15px;
        border: 1px solid #e0e0e0;
        border-radius: 4px;
        background-color: #f8f9fa;
    }
    .memory-detail-pane {
        flex: 2; /* Takes up 2 parts */
        overflow-y: auto;
        padding: 15px;
        border: 1px solid #e0e0e0;
        border-radius: 4px;
        background-color: #fff;
    }
    .memory-list-pane h3, .memory-detail-pane h3 {
        margin-top: 0;
        color: #34495e;
        border-bottom: 1px solid #eee;
        padding-bottom: 8px;
        margin-bottom: 15px;
    }
     .memory-list-pane h4 {
        margin-top: 15px;
        margin-bottom: 5px;
        color: #2c3e50;
     }
    .memory-list-pane ul {
        list-style: none;
        padding-left: 10px;
    }
    .memory-list-pane li {
        margin-bottom: 5px;
    }
    .memory-list-pane a {
        text-decoration: none;
        color: #3498db;
    }
    .memory-list-pane a:hover {
        text-decoration: underline;
    }
    #item-details-content p i {
        color: #777;
    }
    #item-details-content dl { /* Style for definition list */
        margin-top: 10px;
    }
    #item-details-content dt {
        font-weight: bold;
        color: #555;
        margin-top: 8px;
    }
    #item-details-content dd {
        margin-left: 20px;
        margin-bottom: 8px;
    }
    #item-details-content ul {
        margin-left: 20px;
        list-style: disc;
    }
</style>

<script>
    function loadItemDetails(itemId) {
        const detailsContentDiv = document.getElementById('item-details-content');
        detailsContentDiv.innerHTML = '<p><i>Loading details...</i></p>'; // Loading indicator

        fetch(`/api/memory_item/${itemId}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(details => {
                let detailsHtml = `<h4>${details.name || 'N/A'} (${details.id || 'N/A'})</h4>`;
                detailsHtml += '<dl>'; // Use definition list for key-value pairs

                for (const [key, value] of Object.entries(details)) {
                    // Skip id and name as they are in the header
                    if (key === 'id' || key === 'name') continue;

                    detailsHtml += `<dt>${key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</dt>`;

                    // Format different value types appropriately
                    if (Array.isArray(value)) {
                        detailsHtml += '<dd><ul>';
                        value.forEach(item => { detailsHtml += `<li>${item}</li>`; });
                        detailsHtml += '</ul></dd>';
                    } else if (typeof value === 'object' && value !== null) {
                        detailsHtml += '<dd><ul>';
                        for (const [subKey, subValue] of Object.entries(value)) {
                             detailsHtml += `<li><strong>${subKey}:</strong> ${subValue}</li>`;
                        }
                        detailsHtml += '</ul></dd>';
                    } else {
                        detailsHtml += `<dd>${value}</dd>`;
                    }
                }
                detailsHtml += '</dl>';
                detailsContentDiv.innerHTML = detailsHtml;
            })
            .catch(error => {
                console.error('Error fetching memory item details:', error);
                detailsContentDiv.innerHTML = `<p><i>Error loading details for ${itemId}.</i></p>`;
            });
    }
</script>
{% endblock %}