# Module Analysis: `forecast_engine/forecast_log_viewer.py`

## 1. Purpose

The `forecast_engine/forecast_log_viewer.py` module provides functionality to load, process, and display summaries of stored forecast logs. It is designed to help users inspect and understand past forecast performance and metadata by presenting key information in a structured and readable format.

## 2. Key Functionalities

*   **Load and Display Forecasts (`load_and_display_forecasts`)**:
    *   Lists forecast log files from a specified directory (defaults to `PATHS["FORECAST_HISTORY"]`).
    *   Uses [`ForecastTracker`](forecast_engine/forecast_tracker.py:0) to load individual forecast data from JSON files.
    *   Extracts relevant metadata for each forecast, including `forecast_id`, `confidence`, `fragility`, `symbolic_trigger`, `timestamp`, `domain`, and the source `file`.
    *   Handles missing metadata gracefully by substituting with "-" or "unspecified".
    *   Allows filtering of forecasts by a specific `domain_filter`.
    *   Sorts the collected forecast summaries based on a specified key (`sort_by`, defaults to "confidence") in descending order.
    *   Calculates and prints overall summary statistics: total number of forecasts, average confidence, and average fragility.
    *   Displays the top N forecasts (`top_n`, defaults to 5) in a formatted table using the `tabulate` library.
    *   Includes error handling for loading individual forecast files, logging warnings if a file cannot be processed.

## 3. Role within `forecast_engine/`

This module acts as a utility for inspecting and analyzing the output of the forecast engine. It provides a human-readable interface to the forecast logs, which are likely generated by other components within the `forecast_engine/` (such as the [`ForecastTracker`](forecast_engine/forecast_tracker.py:0) it utilizes). It aids in monitoring, debugging, and understanding forecast generation patterns and quality over time.

## 4. Dependencies

### Internal Pulse Modules:

*   [`forecast_engine.forecast_tracker`](forecast_engine/forecast_tracker.py:0): Imports `ForecastTracker` class, which is central to listing and loading forecast log files.
*   [`utils.log_utils`](utils/log_utils.py:0): Imports [`get_logger()`](utils/log_utils.py:0) for standardized logging within the module.
*   [`core.path_registry`](core/path_registry.py:0): Imports `PATHS` to get the default directory for forecast history (`PATHS["FORECAST_HISTORY"]`).

### External Libraries:

*   `os`: Used for path manipulation (e.g., `os.path.join`).
*   `json`: Implied by the use of [`ForecastTracker`](forecast_engine/forecast_tracker.py:0) which likely handles JSON files, though not directly used in this module's code for parsing.
*   `tabulate`: Used to format and print the forecast summaries in a clean, tabular way.

## 5. Adherence to SPARC Principles

*   **Simplicity**: The code is straightforward and follows a clear logic: list files, load data, process, sort, and display. The use of `tabulate` simplifies the presentation logic.
*   **Iterate**: The module iterates through forecast files and processes them one by one. Error handling for individual file loading allows the process to continue even if some logs are corrupt.
*   **Focus**: The module is highly focused on its specific task of viewing and summarizing forecast logs. It doesn't attempt to perform forecasting or modify logs.
*   **Quality**:
    *   The main function [`load_and_display_forecasts()`](forecast_engine/forecast_log_viewer.py:13) has clear parameters with defaults.
    *   Error handling is present for file loading and for calculating summary statistics.
    *   Logging is used to report issues.
    *   The output is user-friendly due to `tabulate` and summary statistics.
    *   An `assert` statement checks the type of `PATHS`.
*   **Collaboration**: It collaborates with [`ForecastTracker`](forecast_engine/forecast_tracker.py:0) to access forecast data, demonstrating good modular design.

## 6. Overall Assessment

*   **Completeness**: The module appears complete for its stated purpose of viewing and summarizing forecast logs. It provides useful filtering, sorting, and display options.
*   **Clarity**: The code is well-structured and easy to follow. Variable names are descriptive. The use of a dedicated `ForecastTracker` class for data access also contributes to clarity.
*   **Quality**: The module is of good quality. It is robust due to error handling, provides informative output, and uses external libraries effectively. The code is clean and maintainable.

## 7. Recommendations

*   Consider adding more sophisticated filtering options (e.g., by date range, confidence range).
*   The calculation of `avg_conf` and `avg_frag` could be made more robust if `len(summaries)` is zero after filtering, or if all entries have "-" for confidence/fragility (though the current `try-except pass` handles crashes, it might silently ignore cases where no valid numbers are found). A more explicit check or logging could be beneficial.
*   Docstrings for the module itself and the main function would be beneficial, although the function parameters are quite self-explanatory.