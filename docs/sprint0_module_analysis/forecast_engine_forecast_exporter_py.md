# Module Analysis: `forecast_engine/forecast_exporter.py`

## 1. Purpose

The `forecast_exporter.py` module provides functionality to export stored forecast data into human-readable and machine-parsable formats. Specifically, it supports exporting forecast summaries to CSV and Markdown files. This allows for easier review, reporting, and external analysis of the forecasts generated by the Pulse system.

## 2. Key Functionalities

*   **CSV Export ([`export_forecast_csv()`](../../forecast_engine/forecast_exporter.py:12)):**
    *   Initializes a [`ForecastTracker`](../../forecast_engine/forecast_tracker.py:5) to access forecast data from a specified log directory (defaulting to `PATHS["FORECAST_HISTORY"]`).
    *   Lists all available forecast files.
    *   Creates a CSV file with a header row: "Forecast ID", "Confidence", "Fragility", "Symbolic Trigger", "Timestamp", "Domain", "File".
    *   Iterates through each forecast file, loads its data, and extracts relevant metadata.
    *   Optionally filters forecasts by a `domain_filter`.
    *   Writes a row to the CSV for each selected forecast.
    *   Includes error handling to log issues if a specific file fails to export.

*   **Markdown Export ([`export_forecast_markdown()`](../../forecast_engine/forecast_exporter.py:38)):**
    *   Similar to CSV export, it uses [`ForecastTracker`](../../forecast_engine/forecast_tracker.py:5) to list and load forecast data.
    *   Creates a Markdown file.
    *   Writes a main heading "# ðŸ“Š Pulse Forecast Summary".
    *   For each forecast (optionally filtered by `domain_filter`):
        *   Creates a level 2 heading with the `forecast_id`.
        *   Lists key metadata: Timestamp, Confidence, Fragility, Symbolic Trigger, Domain, and Source File.
        *   Uses "-" as a placeholder for missing metadata values.
    *   Includes error handling for individual file export failures.

## 3. Role within `forecast_engine/`

This module serves as an output utility within the `forecast_engine/`. After forecasts are generated, tracked (presumably by [`ForecastTracker`](../../forecast_engine/forecast_tracker.py:5)), and stored, this exporter allows users or other processes to extract this information in structured formats. It bridges the gap between internal forecast storage and external consumption or review.

## 4. Dependencies

### Internal Pulse Modules:
*   [`forecast_engine.forecast_tracker.ForecastTracker`](../../forecast_engine/forecast_tracker.py:5)
*   [`utils.log_utils.get_logger`](../../utils/log_utils.py)
*   [`core.path_registry.PATHS`](../../core/path_registry.py) (specifically `PATHS["FORECAST_HISTORY"]`)

### External Libraries:
*   `os` (Python standard library)
*   `json` (Python standard library, likely used by `ForecastTracker.load_forecast`)
*   `csv` (Python standard library)
*   `datetime` (Python standard library, though not directly used in the provided snippet, it's imported)

## 5. Adherence to SPARC Principles

*   **Simplicity:** The functions for exporting to CSV and Markdown are relatively straightforward, iterating through files and writing formatted data.
*   **Iterate:** The module iterates over stored forecasts. The design allows for new export formats to be added as new functions if needed.
*   **Focus:** It is clearly focused on the task of exporting forecast data into specific output formats.
*   **Quality:**
    *   The module uses type hinting (implied by `assert isinstance(PATHS, dict)` and the import of `datetime`, though not explicitly in function signatures in the snippet).
    *   It uses a centralized path configuration ([`PATHS`](../../core/path_registry.py)).
    *   Error handling is present for individual file processing, allowing the export to continue even if some files are problematic.
    *   Logging is used to report errors.
    *   The separation of concerns (using [`ForecastTracker`](../../forecast_engine/forecast_tracker.py:5) to handle data loading) is good.
*   **Collaboration:** By providing data in standard formats like CSV and Markdown, it enables collaboration with other tools, systems, or human analysts who need to consume or review forecast data.

## 6. Overall Assessment

*   **Completeness:** The module is complete for its stated functions of exporting to CSV and Markdown. It covers basic filtering by domain.
*   **Clarity:** The code is clear and easy to follow. Function and variable names are descriptive. The structure of both export functions is similar, making them easy to understand in parallel.
*   **Quality:** The quality is good. It handles file operations correctly (e.g., `with open(...)`), uses standard libraries effectively, and includes necessary error logging. The use of [`ForecastTracker`](../../forecast_engine/forecast_tracker.py:5) encapsulates the logic for finding and loading forecasts, which is a good design choice. The `assert isinstance(PATHS, dict)` is a simple but effective runtime check for a critical configuration dependency.