# Module Analysis: `dev_tools/episode_memory_viewer.py`

## 1. Module Intent/Purpose

The module [`dev_tools/episode_memory_viewer.py`](../../dev_tools/episode_memory_viewer.py:1) is a command-line interface (CLI) utility designed to explore and visualize symbolic episode memory. Its primary role is to:
- Read and process forecast episode logs.
- Summarize symbolic arcs and tags found within these logs.
- Optionally display a plot of arc frequency.
- Optionally export the generated summary to a JSON file.

This tool aids developers or analysts in understanding the content and patterns within the symbolic memory generated by the system.

## 2. Operational Status/Completeness

The module appears to be **functionally complete** for its stated objectives.
- It implements all described features: log parsing (via an imported function), summary generation, plotting (via an imported function), and JSON export.
- The CLI arguments are well-defined.
- Basic error handling is present for file export ([`dev_tools/episode_memory_viewer.py:28`](../../dev_tools/episode_memory_viewer.py:28)).
- No `TODO` comments or obvious placeholders for unfinished functionality are present in the provided code.

## 3. Implementation Gaps / Unfinished Next Steps

- **No Major Gaps for Current Scope:** The module fulfills its defined purpose as a simple viewer. There are no strong indications that it was intended to be significantly more extensive and then left unfinished.
- **Potential Enhancements (Logical Next Steps):**
    - More advanced visualization options (e.g., interactive plots, graph-based representations of episodes, tag co-occurrence heatmaps).
    - Enhanced filtering capabilities for summaries (e.g., filter by specific tags, date ranges, or arc types).
    - Integration into a larger diagnostics dashboard or GUI instead of being a standalone CLI tool.
    - More robust error handling for log file parsing (currently reliant on the imported `summarize_episodes` function).
- **Development Path:** Development seems to have completed the planned path for this specific utility.

## 4. Connections & Dependencies

### Direct Project Module Imports
- `from trust_system.forecast_episode_logger import summarize_episodes, plot_episode_arcs` ([`dev_tools/episode_memory_viewer.py:18`](../../dev_tools/episode_memory_viewer.py:18)): Core functions for summarizing and plotting are imported from this module.

### External Library Dependencies
- `sys`: Used for `sys.path` manipulation ([`dev_tools/episode_memory_viewer.py:13`](../../dev_tools/episode_memory_viewer.py:13)).
- `os`: Used for path manipulation (`os.path.abspath`, `os.path.dirname`) ([`dev_tools/episode_memory_viewer.py:14`](../../dev_tools/episode_memory_viewer.py:14)).
- `argparse`: Used for parsing command-line arguments ([`dev_tools/episode_memory_viewer.py:16`](../../dev_tools/episode_memory_viewer.py:16)).
- `json`: Used for loading and dumping JSON data (for export) ([`dev_tools/episode_memory_viewer.py:17`](../../dev_tools/episode_memory_viewer.py:17)).
- **Implicit:** `matplotlib` or a similar plotting library is likely a dependency of `trust_system.forecast_episode_logger.plot_episode_arcs`.

### Interactions via Shared Data
- **Input Data:** Reads forecast episode data from a JSONL file. The default path is [`logs/forecast_episodes.jsonl`](../../logs/forecast_episodes.jsonl), configurable via the `--log` CLI argument. This file is presumably generated by other parts of the Pulse system, particularly related to the `trust_system`.

### Input/Output Files
- **Input:**
    - Episode log file: JSONL format (e.g., [`logs/forecast_episodes.jsonl`](../../logs/forecast_episodes.jsonl)).
- **Output:**
    - Console output: Prints summary statistics if `--summary` is used.
    - Graphical plot: Displays a plot if `--plot` is used (via `plot_episode_arcs`).
    - JSON file: Exports the summary if `--export <path>` is used (e.g., `summary_export.json`).

## 5. Function and Class Example Usages

This module primarily consists of two functions:

- **`save_summary(summary: dict, path: str)` ([`dev_tools/episode_memory_viewer.py:20`](../../dev_tools/episode_memory_viewer.py:20))**
    - **Purpose:** Saves a given summary dictionary to a specified file path in JSON format.
    - **Usage:**
      ```python
      # summary_data is a dictionary
      # export_path is a string like "output/episode_summary.json"
      save_summary(summary_data, export_path)
      ```

- **`main()` ([`dev_tools/episode_memory_viewer.py:31`](../../dev_tools/episode_memory_viewer.py:31))**
    - **Purpose:** Main execution function that parses CLI arguments, processes episode logs, and generates requested outputs (summary, plot, export).
    - **Usage (CLI):**
      ```bash
      # Basic summary
      python dev_tools/episode_memory_viewer.py --log path/to/forecast_episodes.jsonl --summary

      # Summary and plot
      python dev_tools/episode_memory_viewer.py --log path/to/forecast_episodes.jsonl --summary --plot

      # Export summary to JSON
      python dev_tools/episode_memory_viewer.py --log path/to/forecast_episodes.jsonl --export my_summary.json
      ```
      The script includes an example usage comment:
      `# python dev_tools/episode_memory_viewer.py --log logs/forecast_episodes.jsonl --summary` ([`dev_tools/episode_memory_viewer.py:55`](../../dev_tools/episode_memory_viewer.py:55))

## 6. Hardcoding Issues

- **Default Log Path:** The default path for the episode log file is hardcoded as `"logs/forecast_episodes.jsonl"` within the `argparse` definition ([`dev_tools/episode_memory_viewer.py:33`](../../dev_tools/episode_memory_viewer.py:33)). While this is configurable via a CLI argument, a more flexible approach might involve a configuration file or environment variable for the default.
- **`sys.path` Manipulation:** The line `sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))` ([`dev_tools/episode_memory_viewer.py:15`](../../dev_tools/episode_memory_viewer.py:15)) is used to enable imports from the project's root directory. This is a common pattern for scripts within a project not installed as a package, but it can be brittle if the script is moved or the project structure changes significantly. A more robust solution would be to ensure the project is installed in the Python environment (e.g., using `pip install -e .`) or by setting the `PYTHONPATH` environment variable.

## 7. Coupling Points

- **High Coupling with `trust_system.forecast_episode_logger`:** The module is tightly coupled to [`summarize_episodes()`](../../trust_system/forecast_episode_logger.py) and [`plot_episode_arcs()`](../../trust_system/forecast_episode_logger.py) from the [`trust_system.forecast_episode_logger`](../../trust_system/forecast_episode_logger.py) module. Any changes to the signature, behavior, or expected input format of these functions would directly break this viewer.
- **Data Format Dependency:** Relies on the specific JSONL format of the episode log files generated by the system. Changes to this log format would require updates to the parsing logic within `summarize_episodes` (and transitively affect this viewer).

## 8. Existing Tests

- **No Formal Unit Tests:** There is no evidence of a dedicated test file (e.g., `tests/test_dev_tools_episode_memory_viewer.py`) in the provided project structure.
- **Informal Test Case:** A commented-out example usage at the end of the script serves as a basic manual test:
  `# python dev_tools/episode_memory_viewer.py --log logs/forecast_episodes.jsonl --summary` ([`dev_tools/episode_memory_viewer.py:55`](../../dev_tools/episode_memory_viewer.py:55)).
- **Gaps:**
    - Unit tests for the [`save_summary()`](../../dev_tools/episode_memory_viewer.py:20) function, especially for error conditions (e.g., invalid path, non-dict summary).
    - Tests for the CLI argument parsing in [`main()`](../../dev_tools/episode_memory_viewer.py:31).
    - Mock-based tests to verify correct calls to imported functions ([`summarize_episodes()`](../../trust_system/forecast_episode_logger.py), [`plot_episode_arcs()`](../../trust_system/forecast_episode_logger.py)) based on CLI arguments.

## 9. Module Architecture and Flow

The module follows a standard CLI script architecture:

1.  **Imports:** Standard libraries, OS utilities, and specific project functions ([`trust_system.forecast_episode_logger`](../../trust_system/forecast_episode_logger.py)).
2.  **Path Modification:** Adjusts `sys.path` to ensure project-level imports work correctly when the script is run directly.
3.  **`save_summary` Function:** A helper function to encapsulate the logic of writing the summary dictionary to a JSON file, including basic error handling.
4.  **`main` Function:**
    a.  **Argument Parsing:** Initializes `argparse.ArgumentParser` to define and parse command-line arguments (`--log`, `--summary`, `--plot`, `--export`).
    b.  **Episode Summarization:** Calls [`summarize_episodes(args.log)`](../../trust_system/forecast_episode_logger.py) to process the specified log file.
    c.  **Conditional Output:**
        i.  If `--summary` is passed, it iterates through the returned summary dictionary and prints its contents to the console.
        ii. If `--export` is passed with a file path, it calls [`save_summary()`](../../dev_tools/episode_memory_viewer.py:20) to save the summary.
        iii.If `--plot` is passed, it calls [`plot_episode_arcs(args.log)`](../../trust_system/forecast_episode_logger.py) to generate and display the plot.
5.  **Script Execution Block:** The `if __name__ == "__main__":` block ensures [`main()`](../../dev_tools/episode_memory_viewer.py:31) is executed when the script is run directly.

The control flow is linear based on the provided CLI arguments.

## 10. Naming Conventions

- **Functions:** `save_summary`, `main` – follow PEP 8 `snake_case`.
- **Variables:** `parser`, `args`, `summary`, `path`, `k`, `v` – follow PEP 8 `snake_case`.
- **CLI Arguments:** `--log`, `--summary`, `--plot`, `--export` – standard descriptive kebab-case for CLI flags.
- **Module Name:** `episode_memory_viewer.py` – `snake_case`, descriptive.
- **Constants:** No global constants are defined.
- **Overall:** Naming conventions are consistent and adhere to Python community standards (PEP 8). There are no apparent AI-generated naming anomalies. The author tag "Pulse AI Engine" ([`dev_tools/episode_memory_viewer.py:11`](../../dev_tools/episode_memory_viewer.py:11)) is a metadata comment and does not reflect on code naming.